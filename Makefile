.PHONY: help up down logs install run migrate makemigrations superuser shell test fresh-start load-test-data load-fixtures quick-start

# –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ .env —Ñ–∞–π–ª –¥–ª—è –∑–º—ñ–Ω–Ω–∏—Ö
include .env
export

help:
	@echo "–î–æ—Å—Ç—É–ø–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–æ—î–∫—Ç–æ–º –ê–°–û–û–° '–û–ë–†–Ü–ì':"
	@echo ""
	@echo "  === –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ ==="
	@echo "  make quick-start    - üöÄ –®–í–ò–î–ö–ò–ô –°–¢–ê–†–¢: –∑–∞–ø—É—Å–∫–∞—î –ë–î, –º—ñ–≥—Ä–∞—Ü—ñ—ó, —Å—Ç–≤–æ—Ä—é—î –∞–¥–º—ñ–Ω–∞ —ñ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ."
	@echo "  make up             - –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö —É —Ñ–æ–Ω–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ."
	@echo "  make down           - –ó—É–ø–∏–Ω–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö."
	@echo "  make logs           - –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ."
	@echo "  make install        - –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ Python –∑ requirements.txt."
	@echo "  make run            - –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä —Ä–æ–∑—Ä–æ–±–∫–∏ Django."
	@echo ""
	@echo "  === –†–æ–±–æ—Ç–∞ –∑ –ë–î —Ç–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è–º–∏ ==="
	@echo "  make migrate        - –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö."
	@echo "  make makemigrations - –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—ñ —Ñ–∞–π–ª–∏ –º—ñ–≥—Ä–∞—Ü—ñ–π –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∑–º—ñ–Ω —É –º–æ–¥–µ–ª—è—Ö."
	@echo "  make superuser      - –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–æ–≥–æ —Å—É–ø–µ—Ä–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞)."
	@echo "  make shell          - –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω—É –æ–±–æ–ª–æ–Ω–∫—É Django (shell_plus)."
	@echo ""
	@echo "  === –¢–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ ==="
	@echo "  make load-test-data - üì¶ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø–æ–≤–Ω–∏–π –Ω–∞–±—ñ—Ä —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö (–ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∏, –ø–µ—Ä—Å–æ–Ω–∞–ª, –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∏)."
	@echo "  make load-fixtures  - üìã –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –±–∞–∑–æ–≤—ñ –¥–∞–Ω—ñ –∑ fixtures (–∑–≤–∞–Ω–Ω—è, –í–û–°)."
	@echo ""
	@echo "  === –†–æ–∑—Ä–æ–±–∫–∞ —Ç–∞ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è ==="
	@echo "  make test           - –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏ –¥–ª—è –ø—Ä–æ—î–∫—Ç—É."
	@echo "  make fresh-start    - üî• –ü–û–í–ù–Ü–°–¢–Æ –í–ò–î–ê–õ–ò–¢–ò –ë–ê–ó–£ –î–ê–ù–ò–• —Ç–∞ –ø–æ—á–∞—Ç–∏ –∑ –Ω—É–ª—è."
	@echo ""
	@echo "  === –ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ ==="
	@echo "  make check-deploy   - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –ø—Ä–æ—î–∫—Ç—É –¥–æ deployment."
	@echo "  make show-urls      - –ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ URL –ø—Ä–æ—î–∫—Ç—É."
	@echo "  make db-shell       - –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ –∫–æ–Ω—Å–æ–ª—ñ PostgreSQL."
	@echo ""

up:
	@echo "üöÄ –ó–∞–ø—É—Å–∫–∞—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö PostgreSQL..."
	docker-compose up -d
	@echo "‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –∑–∞–ø—É—â–µ–Ω–∞. –û—á—ñ–∫—É—é –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ..."
	@sleep 3

down:
	@echo "üõë –ó—É–ø–∏–Ω—è—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö..."
	docker-compose down

logs:
	@echo "üìú –ü–µ—Ä–µ–≥–ª—è–¥–∞—é –ª–æ–≥–∏ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö..."
	docker-compose logs -f db

install:
	@echo "üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª—é—é –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ Python..."
	pip install -r requirements.txt
	@echo "‚úÖ –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"

run:
	@echo "üåê –ó–∞–ø—É—Å–∫–∞—é —Å–µ—Ä–≤–µ—Ä —Ä–æ–∑—Ä–æ–±–∫–∏ Django –Ω–∞ http://127.0.0.1:8000/"
	@echo "üìä –ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å: http://127.0.0.1:8000/admin/"
	@echo "üë• –û—Å–æ–±–æ–≤–∏–π —Å–∫–ª–∞–¥: http://127.0.0.1:8000/"
	@echo "üè¢ –ü—ñ–¥—Ä–æ–∑–¥—ñ–ª–∏: http://127.0.0.1:8000/staffing/"
	python manage.py runserver

migrate:
	@echo "üîÑ –ó–∞—Å—Ç–æ—Å–æ–≤—É—é –º—ñ–≥—Ä–∞—Ü—ñ—ó –±–∞–∑–∏ –¥–∞–Ω–∏—Ö..."
	python manage.py migrate
	@echo "‚úÖ –ú—ñ–≥—Ä–∞—Ü—ñ—ó –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ"

makemigrations:
	@echo "üìù –°—Ç–≤–æ—Ä—é—é –Ω–æ–≤—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó..."
	python manage.py makemigrations
	@echo "‚úÖ –ú—ñ–≥—Ä–∞—Ü—ñ—ó —Å—Ç–≤–æ—Ä–µ–Ω–æ"

superuser:
	@echo "üë§ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—É–ø–µ—Ä–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞..."
	@echo "–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:"
	@echo "  Username: admin"
	@echo "  Password: admin123"
	@echo "  Email: admin@mil.gov.ua"
	python manage.py createsuperuser

shell:
	@echo "üêö –ó–∞–ø—É—Å–∫–∞—é Django shell..."
	python manage.py shell_plus --print-sql

test:
	@echo "üß™ –ó–∞–ø—É—Å–∫–∞—é —Ç–µ—Å—Ç–∏..."
	python manage.py test

fresh-start:
	@echo "üî• –£–í–ê–ì–ê! –¶–µ –≤–∏–¥–∞–ª–∏—Ç—å –≤—Å—ñ –¥–∞–Ω—ñ –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö!"
	@read -p "–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ? (y/N): " confirm && [ "$$confirm" = "y" ] || exit 1
	@echo "üóëÔ∏è –í–∏–¥–∞–ª—è—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–∞ –¥–∞–Ω—ñ..."
	docker-compose down -v
	@echo "‚úÖ –î–∞–Ω—ñ –≤–∏–¥–∞–ª–µ–Ω–æ. –ó–∞–ø—É—Å–∫–∞—é –Ω–æ–≤—É –±–∞–∑—É –¥–∞–Ω–∏—Ö..."
	@make up
	@sleep 5
	@echo "üìù –ó–∞—Å—Ç–æ—Å–æ–≤—É—é –º—ñ–≥—Ä–∞—Ü—ñ—ó..."
	@make migrate
	@echo "‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –≥–æ—Ç–æ–≤–∞ –¥–æ —Ä–æ–±–æ—Ç–∏!"

load-test-data:
	@echo "üì¶ –ó–∞–≤–∞–Ω—Ç–∞–∂—É—é —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ..."
	@echo "–¶–µ —Å—Ç–≤–æ—Ä–∏—Ç—å:"
	@echo "  ‚Ä¢ –í—ñ–π—Å—å–∫–æ–≤—ñ –∑–≤–∞–Ω–Ω—è (21 –∑–≤–∞–Ω–Ω—è)"
	@echo "  ‚Ä¢ –í—ñ–π—Å—å–∫–æ–≤–æ-–æ–±–ª—ñ–∫–æ–≤—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—ñ (20 –í–û–°)"
	@echo "  ‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä—É –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª—ñ–≤ (–±—Ä–∏–≥–∞–¥–∞ –∑ –±–∞—Ç–∞–ª—å–π–æ–Ω–∞–º–∏, —Ä–æ—Ç–∞–º–∏, –≤–∑–≤–æ–¥–∞–º–∏)"
	@echo "  ‚Ä¢ –®—Ç–∞—Ç–Ω—ñ –ø–æ—Å–∞–¥–∏ (~500 –ø–æ—Å–∞–¥)"
	@echo "  ‚Ä¢ –í—ñ–π—Å—å–∫–æ–≤–æ—Å–ª—É–∂–±–æ–≤—Ü—ñ–≤ (70% —É–∫–æ–º–ø–ª–µ–∫—Ç–æ–≤–∞–Ω—ñ—Å—Ç—å)"
	@echo "  ‚Ä¢ –ö–æ–Ω—Ç—Ä–∞–∫—Ç–∏ —Ç–∞ —ñ—Å—Ç–æ—Ä—ñ—é —Å–ª—É–∂–±–∏"
	@echo ""
	@echo "‚è≥ –¶–µ –º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ö–≤–∏–ª–∏–Ω..."
	python manage.py create_test_data
	@echo "‚úÖ –¢–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!"

load-fixtures:
	@echo "üìã –ó–∞–≤–∞–Ω—Ç–∞–∂—É—é –±–∞–∑–æ–≤—ñ –¥–∞–Ω—ñ –∑ fixtures..."
	@mkdir -p apps/personnel/fixtures
	@echo "–°—Ç–≤–æ—Ä—é—é fixtures –¥–ª—è –∑–≤–∞–Ω—å —Ç–∞ –í–û–°..."
	python manage.py loaddata apps/personnel/fixtures/initial_data.json
	@echo "‚úÖ Fixtures –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ"

quick-start:
	@echo "üöÄ –®–í–ò–î–ö–ò–ô –°–¢–ê–†–¢ –ü–†–û–Ñ–ö–¢–£ –ê–°–û–û–° '–û–ë–†–Ü–ì'"
	@echo "======================================="
	@echo "–ö—Ä–æ–∫ 1: –ó–∞–ø—É—Å–∫ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö..."
	@make up
	@echo ""
	@echo "–ö—Ä–æ–∫ 2: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π..."
	@make install
	@echo ""
	@echo "–ö—Ä–æ–∫ 3: –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π..."
	@make migrate
	@echo ""
	@echo "–ö—Ä–æ–∫ 4: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞..."
	@echo "–°—Ç–≤–æ—Ä—é—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ admin –∑ –ø–∞—Ä–æ–ª–µ–º admin123..."
	@echo "from django.contrib.auth import get_user_model; User = get_user_model(); User.objects.create_superuser('admin', 'admin@mil.gov.ua', 'admin123') if not User.objects.filter(username='admin').exists() else None" | python manage.py shell
	@echo ""
	@echo "–ö—Ä–æ–∫ 5: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö..."
	@make load-test-data
	@echo ""
	@echo "======================================="
	@echo "‚úÖ –ü–†–û–Ñ–ö–¢ –ì–û–¢–û–í–ò–ô –î–û –†–û–ë–û–¢–ò!"
	@echo "======================================="
	@echo ""
	@echo "üìå –û–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ –¥–ª—è –≤—Ö–æ–¥—É:"
	@echo "  –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä:   admin / admin123"
	@echo "  –ö–∞–¥—Ä–æ–≤–∏–π –æ—Ñ—ñ—Ü–µ—Ä: hr_officer / hr123"
	@echo "  –ö–æ–º–∞–Ω–¥–∏—Ä:        commander / commander123"
	@echo ""
	@echo "üåê –î–ª—è –∑–∞–ø—É—Å–∫—É —Å–µ—Ä–≤–µ—Ä–∞ –≤–∏–∫–æ–Ω–∞–π—Ç–µ: make run"
	@echo "üìä –ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å: http://127.0.0.1:8000/admin/"
	@echo ""

check-deploy:
	@echo "üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ –¥–æ deployment..."
	python manage.py check --deploy
	@echo "‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

show-urls:
	@echo "üìç –î–æ—Å—Ç—É–ø–Ω—ñ URL –∞–¥—Ä–µ—Å–∏:"
	python manage.py show_urls

db-shell:
	@echo "üóÑÔ∏è –ü—ñ–¥–∫–ª—é—á–∞—é—Å—è –¥–æ PostgreSQL..."
	docker exec -it asoos_postgres_db psql -U $(DB_USER) -d $(DB_NAME)